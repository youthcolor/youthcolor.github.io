---
title: 购物篮关联规则分析
categories: R
tags: [购物篮,关联规则,推荐算法]
---
我们生活在一个快速变化的数字世界。在当今时代，亚马逊，淘宝，京东等电商都在购物推荐算法方面做了不同的工作。

这给零售商带来了一个有趣的机遇和挑战。
如果你能告诉顾客他们想要买什么，它不仅能提高你的销售量，还能提高顾客体验，最终提高产品价值。

另一方面，如果您无法预测下一次客户将要购买什么，客户可能不会返回您的商店。

在这篇文章中，我们将学习关联规则算法。

<!--more-->

## 数据准备

```ｒ
# install.packages("pacman")
pacman::p_load(PACKAGE_NAME)
pacman::p_load(arules, arulesViz)
library(arules)
library(arulesViz)
data("Groceries")
# transactions类型
str(Groceries)
Formal class 'transactions' [package "arules"] with 3 slots
  ..@ data       :Formal class 'ngCMatrix' [package "Matrix"] with 5 slots
  .. .. ..@ i       : int [1:43367] 13 60 69 78 14 29 98 24 15 29 ...
  .. .. ..@ p       : int [1:9836] 0 4 7 8 12 16 21 22 27 28 ...
  .. .. ..@ Dim     : int [1:2] 169 9835
  .. .. ..@ Dimnames:List of 2
  .. .. .. ..$ : NULL
  .. .. .. ..$ : NULL
  .. .. ..@ factors : list()
  ..@ itemInfo   :'data.frame':	169 obs. of  3 variables:
  .. ..$ labels: chr [1:169] "frankfurter" "sausage" "liver loaf" "ham" ...
  .. ..$ level2: Factor w/ 55 levels "baby food","bags",..: 44 44 44 44 44 44 44 42 42 41 ...
  .. ..$ level1: Factor w/ 10 levels "canned food",..: 6 6 6 6 6 6 6 6 6 6 ...
  ..@ itemsetInfo:'data.frame':	0 obs. of  0 variables
# 查看数据
head(Groceries@itemInfo, n=12)
              labels  level2           level1
1        frankfurter sausage meat and sausage
2            sausage sausage meat and sausage
3         liver loaf sausage meat and sausage
4                ham sausage meat and sausage
5               meat sausage meat and sausage
6  finished products sausage meat and sausage
7    organic sausage sausage meat and sausage
8            chicken poultry meat and sausage
9             turkey poultry meat and sausage
10              pork    pork meat and sausage
11              beef    beef meat and sausage
12    hamburger meat    beef meat and sausage
```
## 自定义数据transactions类型转换
```r
data <- list(
  c("a","b","c"),
  c("a","b"),
  c("a","b","d"),
  c("b","e"),
  c("b","c","e"),
  c("a","d","e"),
  c("a","c"),
  c("a","b","d"),
  c("c","e"),
  c("a","b","d","e"),
  c("a",'b','e','c')
)
data <- as(data, "transactions")
inspect(data)
     items    
[1]  {a,b,c}  
[2]  {a,b}    
[3]  {a,b,d}  
[4]  {b,e}    
[5]  {b,c,e}  
[6]  {a,d,e}  
[7]  {a,c}    
[8]  {a,b,d}  
[9]  {c,e}    
[10] {a,b,d,e}
[11] {a,b,c,e}
# Convert transactions to transaction ID lists
tl <- as(data, "tidLists")
inspect(tl)
  items transationIDs      
1 a     {1,2,3,6,7,8,10,11}
2 b     {1,2,3,4,5,8,10,11}
3 c     {1,5,7,9,11}       
4 d     {3,6,8,10}         
5 e     {4,5,6,9,10,11}
```
## summary函数查看购买频次最高的商品

```r
summary(Groceries)
transactions as itemMatrix in sparse format with
 9835 rows (elements/itemsets/transactions) and
 169 columns (items) and a density of 0.02609146 

most frequent items:
      whole milk other vegetables       rolls/buns             soda           yogurt 
            2513             1903             1809             1715             1372 
         (Other) 
           34055 

element (itemset/transaction) length distribution:
sizes
   1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17 
2159 1643 1299 1005  855  645  545  438  350  246  182  117   78   77   55   46   29 
  18   19   20   21   22   23   24   26   27   28   29   32 
  14   14    9   11    4    6    1    1    1    1    3    1 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   2.000   3.000   4.409   6.000  32.000 

includes extended item information - examples:
       labels  level2           level1
1 frankfurter sausage meat and sausage
2     sausage sausage meat and sausage
3  liver loaf sausage meat and sausage
```
## 实现关联规则算法

```r
rules <- apriori(Groceries, parameter = list(supp = 0.001, conf = 0.80))
inspect(rules[1:10])
     lhs                                            rhs                support    
[1]  {liquor,red/blush wine}                     => {bottled beer}     0.001931876
[2]  {curd,cereals}                              => {whole milk}       0.001016777
[3]  {yogurt,cereals}                            => {whole milk}       0.001728521
[4]  {butter,jam}                                => {whole milk}       0.001016777
[5]  {soups,bottled beer}                        => {whole milk}       0.001118454
[6]  {napkins,house keeping products}            => {whole milk}       0.001321810
[7]  {whipped/sour cream,house keeping products} => {whole milk}       0.001220132
[8]  {pastry,sweet spreads}                      => {whole milk}       0.001016777
[9]  {turkey,curd}                               => {other vegetables} 0.001220132
[10] {rice,sugar}                                => {whole milk}       0.001220132
     confidence lift     
[1]  0.9047619  11.235269
[2]  0.9090909   3.557863
[3]  0.8095238   3.168192
[4]  0.8333333   3.261374
[5]  0.9166667   3.587512
[6]  0.8125000   3.179840
[7]  0.9230769   3.612599
[8]  0.9090909   3.557863
[9]  0.8000000   4.134524
[10] 1.0000000   3.913649
```
## 频率直方图

```r
library(RColorBrewer)
arules::itemFrequencyPlot(Groceries,topN=20,col=brewer.pal(8,'Pastel2'),
                          main='Relative Item Frequency Plot',
                          type="relative",ylab="Item Frequency (Relative)")
```
![image](http://wx1.sinaimg.cn/mw690/e621a9abgy1finps0o1twj20gx0c7q3e.jpg)
## 支持度和提升度的图形表示
```r
plot(rules[1:20], method = "graph", control = list(type = "items"))
```
![image](http://wx3.sinaimg.cn/mw690/e621a9abgy1finps06ip8j20m80g0q4n.jpg)

## 平行坐标系

```r
plot(rules[1:20], method = "paracoord", control = list(reorder = TRUE))
```
![image](http://wx1.sinaimg.cn/mw690/e621a9abgy1finprzpao3j20m80g0wh8.jpg)
## 矩阵表示

```r
plot(rules[1:20], method = "matrix", control = list(reorder = TRUE))
```
![image](http://wx1.sinaimg.cn/mw690/e621a9abgy1finps1dcllj20m80g0t92.jpg)
## 互动式散点图

```r
arulesViz::plotly_arules(rules)
```
![image](http://wx4.sinaimg.cn/mw690/e621a9abgy1finq568rjbj20m80g10sz.jpg)