<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="youthcolor's blog"><title>R中如何对量化策略进行回测 | Geekdreams</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">R中如何对量化策略进行回测</h1><a id="logo" href="/.">Geekdreams</a><p class="description">Nothing is difficult to the man who will try.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">R中如何对量化策略进行回测</h1><div class="post-meta"><a href="/2017/08/01/R中如何对量化策略进行回测/#comments" class="comment-count"><a id="uyan_count_unit" href="/2017/08/01/R中如何对量化策略进行回测/"></a>留言</a><p><span class="date">Aug 01, 2017</span><span><a href="/categories/R/" class="category">R</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>R中提供了极为便利的回测方法，如<em>PerformanceAnalytics</em>包，下面是简短实例。<br>以A股福田汽车<em>600166.SS</em>为例。<br><a id="more"></a></p>
<h2 id="第1步-获取股票数据"><a href="#第1步-获取股票数据" class="headerlink" title="第1步: 获取股票数据"></a>第1步: 获取股票数据</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setSymbolLookup(MYSTOCK=list(name=<span class="string">'600166.SS'</span>,src=<span class="string">'yahoo'</span>,from=<span class="string">'2007-01-01'</span>))</div><div class="line">getSymbols(<span class="string">'MYSTOCK'</span>)</div></pre></td></tr></table></figure>
<h2 id="第2步-建立指标"><a href="#第2步-建立指标" class="headerlink" title="第2步: 建立指标"></a>第2步: 建立指标</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MYSTOCK &lt;- na.omit(MYSTOCK)</div><div class="line">dvi &lt;- DVI(Cl(MYSTOCK))</div></pre></td></tr></table></figure>
<h2 id="第3步-构建交易规则"><a href="#第3步-构建交易规则" class="headerlink" title="第3步: 构建交易规则"></a>第3步: 构建交易规则</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sig &lt;- Lag(ifelse(dvi$dvi &lt; <span class="number">0.5</span>, <span class="number">1</span>, -<span class="number">1</span>))</div></pre></td></tr></table></figure>
<h2 id="第4步-交易规则-资金曲线"><a href="#第4步-交易规则-资金曲线" class="headerlink" title="第4步: 交易规则/资金曲线"></a>第4步: 交易规则/资金曲线</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ret &lt;- ROC(Cl(MYSTOCK))*(sig-<span class="number">0.00025</span>)</div><div class="line">ret &lt;- ret[<span class="string">'2013-09-01/2014-06-01'</span>]</div><div class="line">eq &lt;- exp(cumsum(ret))</div><div class="line">plot(eq)</div></pre></td></tr></table></figure>
<p><img src="http://wx2.sinaimg.cn/mw690/e621a9abgy1fi34qkv1qmj20gx09kwem.jpg" alt="image"></p>
<h2 id="第5步-评估量化策略的表现"><a href="#第5步-评估量化策略的表现" class="headerlink" title="第5步: 评估量化策略的表现"></a>第5步: 评估量化策略的表现</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">table.Drawdowns(ret, top=<span class="number">10</span>)</div><div class="line">        From     Trough         To   Depth Length To Trough Recovery</div><div class="line"><span class="number">1</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">29</span> <span class="number">2014</span>-<span class="number">02</span>-<span class="number">18</span> <span class="number">2014</span>-<span class="number">03</span>-<span class="number">31</span> -<span class="number">0.1574</span>     <span class="number">39</span>        <span class="number">10</span>       <span class="number">29</span></div><div class="line"><span class="number">2</span> <span class="number">2013</span>-<span class="number">09</span>-<span class="number">02</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">13</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">28</span> -<span class="number">0.1246</span>     <span class="number">99</span>        <span class="number">88</span>       <span class="number">11</span></div><div class="line"><span class="number">3</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">23</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">09</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">19</span> -<span class="number">0.0484</span>     <span class="number">17</span>        <span class="number">11</span>        <span class="number">6</span></div><div class="line"><span class="number">4</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">01</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">03</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">08</span> -<span class="number">0.0206</span>      <span class="number">5</span>         <span class="number">3</span>        <span class="number">2</span></div><div class="line"><span class="number">5</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">09</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">15</span> -<span class="number">0.0163</span>      <span class="number">5</span>         <span class="number">4</span>        <span class="number">1</span></div><div class="line"><span class="number">6</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">22</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">22</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">26</span> -<span class="number">0.0061</span>      <span class="number">3</span>         <span class="number">1</span>        <span class="number">2</span></div><div class="line"><span class="number">7</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">27</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">27</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">28</span> -<span class="number">0.0060</span>      <span class="number">2</span>         <span class="number">1</span>        <span class="number">1</span></div><div class="line"><span class="number">8</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">20</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">20</span> <span class="number">2014</span>-<span class="number">05</span>-<span class="number">21</span> -<span class="number">0.0041</span>      <span class="number">2</span>         <span class="number">1</span>        <span class="number">1</span></div><div class="line">table.DownsideRisk(ret)</div><div class="line">                              <span class="number">600166.</span>SS.Close</div><div class="line">Semi Deviation                         <span class="number">0.0147</span></div><div class="line">Gain Deviation                         <span class="number">0.0119</span></div><div class="line">Loss Deviation                         <span class="number">0.0153</span></div><div class="line">Downside Deviation (MAR=<span class="number">210</span>%)          <span class="number">0.0188</span></div><div class="line">Downside Deviation (Rf=<span class="number">0</span>%)             <span class="number">0.0143</span></div><div class="line">Downside Deviation (<span class="number">0</span>%)                <span class="number">0.0143</span></div><div class="line">Maximum Drawdown                       <span class="number">0.1574</span></div><div class="line">Historical VaR (<span class="number">95</span>%)                  -<span class="number">0.0268</span></div><div class="line">Historical ES (<span class="number">95</span>%)                   -<span class="number">0.0466</span></div><div class="line">Modified VaR (<span class="number">95</span>%)                    -<span class="number">0.0334</span></div><div class="line">Modified ES (<span class="number">95</span>%)                     -<span class="number">0.0617</span></div><div class="line">charts.PerformanceSummary(ret)</div></pre></td></tr></table></figure>
<p><img src="http://wx1.sinaimg.cn/mw690/e621a9abgy1fi34qlhqkdj20m80cjq3d.jpg" alt="image"></p>
</div><div class="tags"><a href="/tags/量化金融/">量化金融</a><a href="/tags/回测/">回测</a></div><div class="post-share"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span><a class="jiathis_button_tsina"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_weixin"></a><a class="jiathis_button_fb"></a><a class="jiathis_button_linkedin"></a><a class="jiathis_button_twitter"></a><a class="jiathis_button_ydnote"></a><a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis"></a><a class="jiathis_counter_style"></a></div></div><div class="post-nav"><a href="/2017/08/18/购物篮关联规则分析/" class="pre">购物篮关联规则分析</a><a href="/2017/07/11/R中的大数据分析/" class="next">R中的大数据分析</a></div><div id="comments"><div id="uyan_frame"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第1步-获取股票数据"><span class="toc-text">第1步: 获取股票数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第2步-建立指标"><span class="toc-text">第2步: 建立指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第3步-构建交易规则"><span class="toc-text">第3步: 构建交易规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第4步-交易规则-资金曲线"><span class="toc-text">第4步: 交易规则/资金曲线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第5步-评估量化策略的表现"><span class="toc-text">第5步: 评估量化策略的表现</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/10/译：机器学习算法要点（附Python和R代码）/">译：机器学习算法要点（附Python和R代码）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/23/侦测欺诈交易/">侦测欺诈交易</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/购物篮关联规则分析/">购物篮关联规则分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/01/R中如何对量化策略进行回测/">R中如何对量化策略进行回测</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/R中的大数据分析/">R中的大数据分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/R机器学习之股票预测初探/">R机器学习之股票预测初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/R/">R</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/离群值侦测排序/" style="font-size: 15px;">离群值侦测排序</a> <a href="/tags/量化金融/" style="font-size: 15px;">量化金融</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/聚类/" style="font-size: 15px;">聚类</a> <a href="/tags/线性回归/" style="font-size: 15px;">线性回归</a> <a href="/tags/股票预测/" style="font-size: 15px;">股票预测</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/特征选取/" style="font-size: 15px;">特征选取</a> <a href="/tags/欺诈侦测/" style="font-size: 15px;">欺诈侦测</a> <a href="/tags/半监督分类/" style="font-size: 15px;">半监督分类</a> <a href="/tags/类失衡/" style="font-size: 15px;">类失衡</a> <a href="/tags/贝叶斯分类器/" style="font-size: 15px;">贝叶斯分类器</a> <a href="/tags/AdaBoost分类器/" style="font-size: 15px;">AdaBoost分类器</a> <a href="/tags/决策精确度/" style="font-size: 15px;">决策精确度</a> <a href="/tags/回溯精确度/" style="font-size: 15px;">回溯精确度</a> <a href="/tags/交叉验证/" style="font-size: 15px;">交叉验证</a> <a href="/tags/回测/" style="font-size: 15px;">回测</a> <a href="/tags/逻辑回归/" style="font-size: 15px;">逻辑回归</a> <a href="/tags/决策树/" style="font-size: 15px;">决策树</a> <a href="/tags/支持向量机/" style="font-size: 15px;">支持向量机</a> <a href="/tags/朴素贝叶斯/" style="font-size: 15px;">朴素贝叶斯</a> <a href="/tags/最近邻（KNN）/" style="font-size: 15px;">最近邻（KNN）</a> <a href="/tags/K-均值/" style="font-size: 15px;">K-均值</a> <a href="/tags/随机森林/" style="font-size: 15px;">随机森林</a> <a href="/tags/降维算法/" style="font-size: 15px;">降维算法</a> <a href="/tags/梯度下降算法/" style="font-size: 15px;">梯度下降算法</a> <a href="/tags/GBM/" style="font-size: 15px;">GBM</a> <a href="/tags/XGBoost/" style="font-size: 15px;">XGBoost</a> <a href="/tags/LightGBM/" style="font-size: 15px;">LightGBM</a> <a href="/tags/CatBoost/" style="font-size: 15px;">CatBoost</a> <a href="/tags/购物篮/" style="font-size: 15px;">购物篮</a> <a href="/tags/关联规则/" style="font-size: 15px;">关联规则</a> <a href="/tags/推荐算法/" style="font-size: 15px;">推荐算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://weibo.com/youthcolor" title="Geekdreams" target="_blank">Geekdreams</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">youthcolor.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>var jiathis_config={
    data_track_clickback:true,
    summary:"",
    shortUrl:true,
    hideMore:false
}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script><script src="http://v2.uyan.cc/code/uyan.js?uid=2136627"></script></body></html>